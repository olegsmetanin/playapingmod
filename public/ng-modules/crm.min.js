/*! playapingmod - v0.0.1 - 2013-08-01
 * http://olegsmith.github.com/
 * Copyright (c) 2013 Oleg Smetanin & Artem Naumov;
 * Licensed MIT
 */
angular.module("crm",["ui.state","ui.select2","ui.date","crm.templates"]).config(["$routeProvider","$locationProvider","$stateProvider","$urlRouterProvider",function(a,b,c,d){d.otherwise("/contracts");var e={name:"page2C.contractList",url:"/contracts",views:{sidebar:{templateUrl:"/ng-modules/crm/contracts/list/contractListFilter.tpl.html"},content:{templateUrl:"/ng-modules/crm/contracts/list/contractListGrid.tpl.html"}}},f={name:"tabPage1C.contractCommonTab",url:"/contracts/:contractid/common",views:{tabbar:{template:'<div ng-controller="contractTabsCtrl" tabbar="0"></div>'},content:{templateUrl:"/ng-modules/crm/contracts/commonTab/contractCommonTab.tpl.html"}}},g={name:"tabPage2C.contractTasksTab",url:"/contracts/:contractid/tasks",views:{tabbar:{template:'<div ng-controller="contractTabsCtrl" tabbar="1"></div>'},sidebar:{templateUrl:"/ng-modules/crm/contracts/tasksTab/contractTasksTabFilter.tpl.html"},content:{templateUrl:"/ng-modules/crm/contracts/tasksTab/contractTasksTabGrid.tpl.html"}}};c.state(e).state(f).state(g)}]).service("contractService",["$q","$http",function(a,b){this.getContracts=function(c){var d=a.defer();return b.post("/api/v1",{action:"get",model:"project.contracts",project:window.app.project,filter:c}).success(function(a){d.resolve(a)}).error(function(){}),d.promise}}]).controller("contractListGridCtrl",["$scope","contractService","pageConfig",function(a,b,c){c.setConfig({breadcrumbs:[{name:"Projects",url:"/projects"},{name:window.app.project,url:"/projects/"+window.app.project},{name:"Contracts",url:"#!/contracts"}]}),a.contracts=[],b.getContracts({}).then(function(b){a.contracts=b.contracts})}]).controller("contractTabsCtrl",["$scope","$stateParams",function(a,b){a.tabs=[{name:"Common",url:"#!/contracts/"+b.contractid+"/common"},{name:"Tasks",url:"#!/contracts/"+b.contractid+"/tasks"}]}]).controller("contractCommonTabCtrl",["$scope","$stateParams","pageConfig",function(a,b,c){var d=b.contractid;c.setConfig({breadcrumbs:[{name:"Projects",url:"/projects"},{name:window.app.project,url:"/projects/"+window.app.project},{name:"contracts",url:"#!/contracts"},{name:d,url:"#!/contracts/"+d+"/common"}]}),a.contractid=d}]).controller("contractItemCtrl",["$scope","$q","$timeout",function(a,b,c){var d=[{id:1,text:"cat"},{id:2,text:"dog"},{id:3,text:"pet"},{id:4,text:"rat"},{id:5,text:"fat"},{id:6,text:"zet"}],e={name:"contract-123",signedAt:new Date(2010,1,1),category:[{id:1,text:"cat"}]};a.categoryOptions={multiple:!0,query:function(a){c(function(){var b={results:d};a.callback(b)},400)}},a.mode="View",a.contract=angular.copy(e),a.edit=function(){a.mode="Edit"},a.cancel=function(){a.contract=angular.copy(e),a.mode="View"},a.update=function(){contractForm&&(e=angular.copy(a.contract)),a.mode="View"},a.isChanged=function(){return!angular.equals(a.contract,e)}}]).directive("requiredMultiple",function(){function a(a){return angular.isUndefined(a)||angular.isArray(a)&&0===a.length||""===a||null===a||a!==a}return{require:"?ngModel",link:function(b,c,d,e){if(e){d.required=!0;var f=function(b){return d.required&&(a(b)||b===!1)?(e.$setValidity("required",!1),void 0):(e.$setValidity("required",!0),b)};e.$formatters.push(f),e.$parsers.unshift(f),d.$observe("required",function(){f(e.$viewValue)})}}}}).directive("fakeServerValidation",["$timeout",function(a){return{require:"ngModel",link:function(b,c,d,e){var f=function(b){return a(function(){b&&b.indexOf("-")>0?e.$setValidity("fsv",!0):e.$setValidity("fsv",!1)},500),b};e.$formatters.push(f),e.$parsers.unshift(f)}}}]),angular.module("crm.templates",["/ng-modules/crm/contracts/commonTab/contractCommonTab.tpl.html","/ng-modules/crm/contracts/list/contractListFilter.tpl.html","/ng-modules/crm/contracts/list/contractListGrid.tpl.html","/ng-modules/crm/contracts/tasksTab/contractTasksTabFilter.tpl.html","/ng-modules/crm/contracts/tasksTab/contractTasksTabGrid.tpl.html"]),angular.module("/ng-modules/crm/contracts/commonTab/contractCommonTab.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/crm/contracts/commonTab/contractCommonTab.tpl.html",'<div>\n    <div ng-controller="contractCommonTabCtrl">\n        contract id:{{contractid}}\n    </div>\n    <div ng-controller="contractItemCtrl">\n\n        <div ng-switch on="mode">\n\n            <form name="contractForm" ng-switch-when="Edit">\n                <div class="control-group" ng-class="{error: contractForm.name.$invalid}">\n                    <label>Name</label>\n                    <input type="text" name="name" ng-model="contract.name" required="true" fake-server-validation class="input-medium" />\n                    <span ng-show="contractForm.name.$error.required" class="help-inline">Required field</span>\n                    <span ng-show="contractForm.name.$error.fsv" class="help-inline">Invalid name format (no hyphen)</span>\n                </div>\n                <div class="control-group" ng-class="{error: contractForm.signedAt.$invalid}">\n                    <label>Signed at</label>\n                    <input ui-date="{changeMonth: true, changeYear: true}" name="signedAt" ng-model="contract.signedAt" required class="input-medium" />\n                    <span ng-show="contractForm.signedAt.$error.required" class="help-inline">Provide sign date</span>\n                </div>\n                <div class="control-group" ng-class="{error: contractForm.category.$invalid}">\n                    <label>Category</label>\n                    <input type="text" name="category" ui-select2="categoryOptions" ng-model="contract.category" required-multiple class="input-medium" />\n                    <span ng-show="contractForm.category.$error.required" class="help-inline">Select at least one category</span>\n                </div>\n                <div class="form-actions">\n                    <button type="button" class="btn" ng-click="cancel()">Cancel</button>\n                    <button type="button" class="btn btn-success" ng-click="update()" ng-disabled="!isChanged() || contractForm.$invalid">Update</button>\n                </div>\n            </form>\n\n            <form ng-switch-when="View">\n                <div class="control-group">\n                    <label>Name</label>\n                    <span>{{contract.name}}</span>\n                </div>\n                <div class="control-group">\n                    <label>Signed at</label>\n                    <span>{{contract.signedAt | date:\'dd MMMM yyyy\'}}</span>\n                </div>\n                <div class="control-group">\n                    <label>Categories</label>\n                    <span ng-repeat="c in contract.category">{{c.text}}&nbsp;</span>\n                </div>\n                <div class="form-actions">\n                    <button type="button" class="btn" ng-click="edit()">Edit</button>\n                </div>\n            </form>\n\n        </div>\n    </div>\n</div>')}]),angular.module("/ng-modules/crm/contracts/list/contractListFilter.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/crm/contracts/list/contractListFilter.tpl.html","Contract List Filter")}]),angular.module("/ng-modules/crm/contracts/list/contractListGrid.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/crm/contracts/list/contractListGrid.tpl.html",'	<ul ng-controller="contractListGridCtrl">\n		<li ng-repeat="contract in contracts"><a href="#!/contracts/{{contract.id}}/common">{{contract.title}}</a></li>\n	</ul>')}]),angular.module("/ng-modules/crm/contracts/tasksTab/contractTasksTabFilter.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/crm/contracts/tasksTab/contractTasksTabFilter.tpl.html","Contracts Tasks Tab Filter")}]),angular.module("/ng-modules/crm/contracts/tasksTab/contractTasksTabGrid.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/crm/contracts/tasksTab/contractTasksTabGrid.tpl.html","Contract Tasks Tab Grid")}]);