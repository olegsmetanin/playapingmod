/*! playapingmod - v0.0.1 - 2013-07-31
 * http://olegsmith.github.com/
 * Copyright (c) 2013 Oleg Smetanin & Artem Naumov;
 * Licensed MIT
 */
angular.module("crm",["ui.state","ui.select2","ui.date","crm.templates"]).config(["$routeProvider","$locationProvider","$stateProvider","$urlRouterProvider",function(a,b,c,d){d.otherwise("/demands");var e={name:"page2C.demandList",url:"/demands",views:{sidebar:{templateUrl:"/ng-modules/crm/demands/list/demandListFilter.tpl.html"},content:{templateUrl:"/ng-modules/crm/demands/list/demandListGrid.tpl.html"}}},f={name:"tabPage1C.demandCommonTab",url:"/demands/:demandid/common",views:{tabbar:{template:'<div ng-controller="demandTabsCtrl" tabbar="0"></div>'},content:{templateUrl:"/ng-modules/crm/demands/commonTab/demandCommonTab.tpl.html"}}},g={name:"tabPage2C.demandOrdersTab",url:"/demands/:demandid/orders",views:{tabbar:{template:'<div ng-controller="demandTabsCtrl" tabbar="1"></div>'},sidebar:{templateUrl:"/ng-modules/crm/demands/ordersTab/demandOrdersTabFilter.tpl.html"},content:{templateUrl:"/ng-modules/crm/demands/ordersTab/demandOrdersTabGrid.tpl.html"}}};c.state(e).state(f).state(g)}]).service("demandService",["$rootScope",function(){this.getDemands=function(){return{demands:[{id:1,name:"Demand1"},{id:2,name:"Demand2"},{id:3,name:"Demand3"},{id:4,name:"Demand4"},{id:5,name:"Demand5"}]}}}]).controller("demandListGridCtrl",["$scope","demandService","pageConfig",function(a,b,c){c.setConfig({breadcrumbs:[{name:"Projects",url:"/projects"},{name:window.app.project,url:"/projects/"+window.app.project},{name:"Demands",url:"#!/demands"}]}),a.demands=b.getDemands({}).demands}]).controller("demandTabsCtrl",["$scope","$stateParams",function(a,b){a.tabs=[{name:"Common",url:"#!/demands/"+b.demandid+"/common"},{name:"Orders",url:"#!/demands/"+b.demandid+"/orders"}]}]).controller("demandCommonTabCtrl",["$scope","$stateParams","pageConfig",function(a,b,c){var d=b.demandid;c.setConfig({breadcrumbs:[{name:"Projects",url:"/projects"},{name:window.app.project,url:"/projects/"+window.app.project},{name:"Demands",url:"#!/demands"},{name:d,url:"#!/demands/"+d+"/common"}]}),a.demandid=d}]).controller("DemandItemCtrl",["$scope","$q","$timeout",function(a,b,c){var d=[{id:1,text:"cat"},{id:2,text:"dog"},{id:3,text:"pet"},{id:4,text:"rat"},{id:5,text:"fat"},{id:6,text:"zet"}],e={name:"Demand-123",signedAt:new Date(2010,1,1),category:[{id:1,text:"cat"}]};a.categoryOptions={multiple:!0,query:function(a){c(function(){var b={results:d};a.callback(b)},400)}},a.mode="View",a.demand=angular.copy(e),a.edit=function(){a.mode="Edit"},a.cancel=function(){a.demand=angular.copy(e),a.mode="View"},a.update=function(){demandForm&&(e=angular.copy(a.demand)),a.mode="View"},a.isChanged=function(){return!angular.equals(a.demand,e)}}]).directive("requiredMultiple",function(){function a(a){return angular.isUndefined(a)||angular.isArray(a)&&0===a.length||""===a||null===a||a!==a}return{require:"?ngModel",link:function(b,c,d,e){if(e){d.required=!0;var f=function(b){return d.required&&(a(b)||b===!1)?(e.$setValidity("required",!1),void 0):(e.$setValidity("required",!0),b)};e.$formatters.push(f),e.$parsers.unshift(f),d.$observe("required",function(){f(e.$viewValue)})}}}}).directive("fakeServerValidation",["$timeout",function(a){return{require:"ngModel",link:function(b,c,d,e){var f=function(b){return a(function(){b&&b.indexOf("-")>0?e.$setValidity("fsv",!0):e.$setValidity("fsv",!1)},500),b};e.$formatters.push(f),e.$parsers.unshift(f)}}}]),angular.module("crm.templates",["/ng-modules/crm/demands/commonTab/demandCommonTab.tpl.html","/ng-modules/crm/demands/list/demandListFilter.tpl.html","/ng-modules/crm/demands/list/demandListGrid.tpl.html","/ng-modules/crm/demands/ordersTab/demandOrdersTabFilter.tpl.html","/ng-modules/crm/demands/ordersTab/demandOrdersTabGrid.tpl.html"]),angular.module("/ng-modules/crm/demands/commonTab/demandCommonTab.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/crm/demands/commonTab/demandCommonTab.tpl.html",'<div>\n    <div ng-controller="demandCommonTabCtrl">\n        Demand id:{{demandid}}\n    </div>\n    <div ng-controller="DemandItemCtrl">\n\n        <div ng-switch on="mode">\n\n            <form name="demandForm" ng-switch-when="Edit">\n                <div class="control-group" ng-class="{error: demandForm.name.$invalid}">\n                    <label>Name</label>\n                    <input type="text" name="name" ng-model="demand.name" required="true" fake-server-validation class="input-medium" />\n                    <span ng-show="demandForm.name.$error.required" class="help-inline">Required field</span>\n                    <span ng-show="demandForm.name.$error.fsv" class="help-inline">Invalid name format (no hyphen)</span>\n                </div>\n                <div class="control-group" ng-class="{error: demandForm.signedAt.$invalid}">\n                    <label>Signed at</label>\n                    <input ui-date="{changeMonth: true, changeYear: true}" name="signedAt" ng-model="demand.signedAt" required class="input-medium" />\n                    <span ng-show="demandForm.signedAt.$error.required" class="help-inline">Provide sign date</span>\n                </div>\n                <div class="control-group" ng-class="{error: demandForm.category.$invalid}">\n                    <label>Category</label>\n                    <input type="text" name="category" ui-select2="categoryOptions" ng-model="demand.category" required-multiple class="input-medium" />\n                    <span ng-show="demandForm.category.$error.required" class="help-inline">Select at least one category</span>\n                </div>\n                <div class="form-actions">\n                    <button type="button" class="btn" ng-click="cancel()">Cancel</button>\n                    <button type="button" class="btn btn-success" ng-click="update()" ng-disabled="!isChanged() || demandForm.$invalid">Update</button>\n                </div>\n            </form>\n\n            <form ng-switch-when="View">\n                <div class="control-group">\n                    <label>Name</label>\n                    <span>{{demand.name}}</span>\n                </div>\n                <div class="control-group">\n                    <label>Signed at</label>\n                    <span>{{demand.signedAt | date:\'dd MMMM yyyy\'}}</span>\n                </div>\n                <div class="control-group">\n                    <label>Categories</label>\n                    <span ng-repeat="c in demand.category">{{c.text}}&nbsp;</span>\n                </div>\n                <div class="form-actions">\n                    <button type="button" class="btn" ng-click="edit()">Edit</button>\n                </div>\n            </form>\n\n        </div>\n    </div>\n</div>')}]),angular.module("/ng-modules/crm/demands/list/demandListFilter.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/crm/demands/list/demandListFilter.tpl.html","Demand List Filter")}]),angular.module("/ng-modules/crm/demands/list/demandListGrid.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/crm/demands/list/demandListGrid.tpl.html",'	Demands:\n	<ul ng-controller="demandListGridCtrl">\n		<li ng-repeat="demand in demands"><a href="#!/demands/{{demand.id}}/common">{{demand.name}}</a></li>\n	</ul>')}]),angular.module("/ng-modules/crm/demands/ordersTab/demandOrdersTabFilter.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/crm/demands/ordersTab/demandOrdersTabFilter.tpl.html","Demand Order Tab Filter")}]),angular.module("/ng-modules/crm/demands/ordersTab/demandOrdersTabGrid.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/crm/demands/ordersTab/demandOrdersTabGrid.tpl.html","Demands Order Tab Grid")}]);