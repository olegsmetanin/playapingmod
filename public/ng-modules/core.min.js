/*! playapingmod - v0.0.1 - 2013-08-01
 * http://olegsmith.github.com/
 * Copyright (c) 2013 Oleg Smetanin & Artem Naumov;
 * Licensed MIT
 */
angular.module("core",["ui.state","ui.bootstrap","core.security","core.templates"]),angular.module("core").config(["$routeProvider","$locationProvider","$stateProvider","$urlRouterProvider",function(a,b,c){b.hashPrefix("!");var d={name:"page1C","abstract":!0,templateUrl:"/ng-modules/core/masterpages/page1C.tpl.html"},e={name:"page2C","abstract":!0,templateUrl:"/ng-modules/core/masterpages/page2C.tpl.html"},f={name:"tabPage1C","abstract":!0,templateUrl:"/ng-modules/core/masterpages/tabPage1C.tpl.html"},g={name:"tabPage2C","abstract":!0,templateUrl:"/ng-modules/core/masterpages/tabPage2C.tpl.html"};c.state(d).state(e).state(f).state(g)}]).constant("I18N.MESSAGES",{"errors.route.changeError":"Route change error","crud.user.save.success":"A user with id '{{id}}' was saved successfully.","crud.user.remove.success":"A user with id '{{id}}' was removed successfully.","crud.user.remove.error":"Something went wrong when removing user with id '{{id}}'.","crud.user.save.error":"Something went wrong when saving a user...","crud.project.save.success":"A project with id '{{id}}' was saved successfully.","crud.project.remove.success":"A project with id '{{id}}' was removed successfully.","crud.project.save.error":"Something went wrong when saving a project...","login.reason.notAuthorized":"You do not have the necessary access permissions.  Do you want to login as someone else?","login.reason.notAuthenticated":"You must be logged in to access this part of the application.","login.error.invalidCredentials":"Login failed.  Please check your credentials and try again.","login.error.serverError":"There was a problem with authenticating: {{exception}}."}).controller("HeaderCtrl",["$scope","security",function(a,b){a.isAuthenticated=b.isAuthenticated}]),angular.module("core").controller("breadcrumbsCtrl",["$scope","pageConfig",function(a,b){a.breadcrumbs=b.current.breadcrumbs,a.$on("page:configChanged",function(){a.breadcrumbs=b.current.breadcrumbs})}]),angular.module("core").directive("tabbar",function(){return function(a,b,c){for(var d=a.tabs,e=1*c.tabbar,f='<div class="navbar"><div class="navbar-inner"><ul class="nav">',g=0;g<d.length;g++)f+="<li "+(e===g?'class="active"':"")+'><a href="'+d[g].url+'">'+d[g].name+"</a></li>";f=f+"</ul>"+"</div>"+"</div>",b.html(f)}}),angular.module("security.authorization",["security.service"]).provider("securityAuthorization",function(){this.requireGroups=function(a){return["securityAuthorization",function(b){return b.requireGroups(a)}]},this.requireAdminUser=function(){return["securityAuthorization",function(a){return a.requireAdminUser()}]},this.requireAuthenticatedUser=function(){return["securityAuthorization",function(a){return a.requireAuthenticatedUser()}]},this.$get=["security","securityRetryQueue",function(a,b){var c={requireAuthenticatedUser:function(){var d=a.requestCurrentUser().then(function(){return a.isAuthenticated()?void 0:b.pushRetryFn("unauthenticated-client",c.requireAuthenticatedUser)});return d},requireAdminUser:function(){var d=a.requestCurrentUser().then(function(){return a.isAdmin()?void 0:b.pushRetryFn("unauthorized-client",c.requireAdminUser)});return d},requireGroups:function(d){var e=a.requestUserGroups("prj1").then(function(a){for(var e=!1,f=0;f<d.length;f++){var g=d[f];if($.inArray(g,a)>=0){e=!0;break}}return e?void 0:b.pushRetryFn("unauthorized-client",function(){return c.requireGroups(d)})});return e}};return c}]}),angular.module("core.security.backendless",["core","ngMockE2E"]).run(["$httpBackend",function(a){var b=0,c=function(a,c,d){return b++,{id:b,firstName:a,lastName:c,email:a+"."+c+"@abc.com",admin:d}},d=c("a","admin",!0),e=c("ivan","ivanov",!1),f=c("petr","petrov",!1),g=c("sidor","sidorov",!1),h=[d,e,f,g],i={play2:{admins:[e],managers:[e,f],executors:[g]},prj2:{admins:[e],managers:[e],executors:[f]}},j=function(a,b){var c=i[a],d=[],e=null;angular.forEach(h,function(a){a.id===b&&(e=a)});for(var f in c)$.inArray(e,c[f])>=0&&d.push(f);return d};a.whenPOST("/login").respond(function(a,b,c){var d=JSON.parse(c);if("bad@abc.com"===d.email)return[500,"Oops, something went wrong"];var e=null;return angular.forEach(h,function(a){a.email===d.email&&"111"===d.password&&(e=angular.copy(a))}),[200,{user:e}]}),a.whenPOST("/logout").respond(204),a.whenPOST("/user-groups").respond(function(a,b,c){var d=JSON.parse(c);return[200,{groups:j(d.project,d.userId)}]}),a.whenGET(/^(projects|ng-modules|components)*/).passThrough(),a.whenPOST(/^(\/api)*/).passThrough()}]),angular.module("core.security",["security.service","security.interceptor","security.login","security.authorization"]),angular.module("security.interceptor",["security.retryQueue"]).factory("securityInterceptor",["$injector","securityRetryQueue",function(a,b){return function(c){return c.then(null,function(d){return 401===d.status&&(c=b.pushRetryFn("unauthorized-server",function(){return a.get("$http")(d.config)})),c})}}]).config(["$httpProvider",function(a){a.responseInterceptors.push("securityInterceptor")}]),angular.module("security.login.form",["services.localizedMessages"]).controller("LoginFormController",["$scope","security","localizedMessages",function(a,b,c){a.user={},a.authError=null,a.authReason=null,b.getLoginReason()&&(a.authReason=b.isAuthenticated()?c.get("login.reason.notAuthorized"):c.get("login.reason.notAuthenticated")),a.login=function(){a.authError=null,b.login(a.user.email,a.user.password).then(function(b){b||(a.authError=c.get("login.error.invalidCredentials"))},function(b){a.authError=c.get("login.error.serverError",{exception:b})})},a.clearForm=function(){a.user={}},a.cancelLogin=function(){b.cancelLogin()}}]),angular.module("security.login",["security.login.form","security.login.toolbar"]),angular.module("security.login.toolbar",[]).directive("loginToolbar",["security",function(a){var b={templateUrl:"/ng-modules/core/security/login/toolbar.tpl.html",restrict:"E",replace:!0,scope:!0,link:function(b){b.isAuthenticated=a.isAuthenticated,b.login=a.showLogin,b.logout=a.logout,b.$watch(function(){return a.currentUser},function(a){b.currentUser=a})}};return b}]),angular.module("security.retryQueue",[]).factory("securityRetryQueue",["$q","$log",function(a,b){var c=[],d={onItemAddedCallbacks:[],hasMore:function(){return c.length>0},push:function(a){c.push(a),angular.forEach(d.onItemAddedCallbacks,function(c){try{c(a)}catch(d){b.error("securityRetryQueue.push(retryItem): callback threw an error"+d)}})},pushRetryFn:function(b,c){1===arguments.length&&(c=b,b=void 0);var e=a.defer(),f={reason:b,retry:function(){a.when(c()).then(function(a){e.resolve(a)},function(a){e.reject(a)})},cancel:function(){e.reject()}};return d.push(f),e.promise},retryReason:function(){return d.hasMore()&&c[0].reason},cancelAll:function(){for(;d.hasMore();)c.shift().cancel()},retryAll:function(){for(;d.hasMore();)c.shift().retry()}};return d}]),angular.module("security.service",["security.retryQueue","security.login","ui.bootstrap.dialog"]).factory("security",["$http","$q","$location","securityRetryQueue","$dialog",function(a,b,c,d,e){function f(a){a=a||"/",c.path(a),window.location.href="/"}function g(){if(j)throw new Error("Trying to open a dialog that is already open!");j=e.dialog(),j.open("/ng-modules/core/security/login/form.tpl.html","LoginFormController").then(i)}function h(a){j&&j.close(a)}function i(a){j=null,a?d.retryAll():(d.cancelAll(),f())}var j=null;d.onItemAddedCallbacks.push(function(){d.hasMore()&&k.showLogin()});var k={getLoginReason:function(){return d.retryReason()},showLogin:function(){g()},login:function(b,c){var d=a.post("/login",{email:b,password:c});return d.then(function(a){k.currentUser=a.data.user,k.currentProject=k.currentUserGroups=null,k.isAuthenticated()&&h(!0)})},cancelLogin:function(){h(!1),f()},logout:function(b){a.post("/logout").then(function(){k.currentUser=k.currentProject=k.currentUserGroups=null,f(b)})},requestCurrentUser:function(){return k.isAuthenticated()?b.when(k.currentUser):a.get("/current-user").then(function(a){return k.currentUser=a.data.user,k.currentProject=k.currentUserGroups=null,k.currentUser})},currentUser:null,currentProject:null,currentUserGroups:null,isAuthenticated:function(){return!!k.currentUser},isAdmin:function(){return!(!k.currentUser||!k.currentUser.admin)},requestUserGroups:function(c){return k.isAuthenticated()?k.currentProject&&k.currentProject===c?b.when(k.currentUserGroups):a.post("/user-groups",{project:c,userId:k.currentUser.id}).then(function(a){return k.currentProject=c,k.currentUserGroups=a.data.groups,k.currentUserGroups}):b.when([])}};return k}]),angular.module("services.localizedMessages",[]).factory("localizedMessages",["$interpolate","I18N.MESSAGES",function(a,b){var c=function(a,b){return a||"?"+b+"?"};return{get:function(d,e){var f=b[d];return f?a(f)(e):c(f,d)}}}]),angular.module("core").service("pageConfig",["$rootScope",function(a){this.current={},this.setConfig=function(b){this.current=b,a.$broadcast("page:configChanged")}}]),angular.module("core").controller("systemMenuCtrl",["$scope","pageConfig",function(a,b){a.current=b.current.breadcrumb,a.$on("page:configChanged",function(){a.current=b.current.breadcrumb})}]),angular.module("core.templates",["/ng-modules/core/breadcrumbs/breadcrumbs.tpl.html","/ng-modules/core/masterpages/page1C.tpl.html","/ng-modules/core/masterpages/page2C.tpl.html","/ng-modules/core/masterpages/tabPage1C.tpl.html","/ng-modules/core/masterpages/tabPage2C.tpl.html","/ng-modules/core/security/login/form.tpl.html","/ng-modules/core/security/login/toolbar.tpl.html","/ng-modules/core/systemmenu/systemMenu.tpl.html"]),angular.module("/ng-modules/core/breadcrumbs/breadcrumbs.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/core/breadcrumbs/breadcrumbs.tpl.html",'<div ng-controller="breadcrumbsCtrl">\n    <ul class="breadcrumb">\n        <li ng-repeat="breadcrumb in breadcrumbs" ng-class="{\'active\':$last}">\n            <a ng-show="!$last" href="{{breadcrumb.url}}">{{breadcrumb.name}}</a>\n            <span ng-show="$last">{{breadcrumb.name}}</span>\n            <span ng-show="!$last" class="divider">/</span>\n        </li>\n    </ul>\n</div>')}]),angular.module("/ng-modules/core/masterpages/page1C.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/core/masterpages/page1C.tpl.html",'<div class="container-fluid">\n    <div class="row-fluid">\n        <div class="span12">\n            <div ng-include="\'/ng-modules/core/breadcrumbs/breadcrumbs.tpl.html\'"></div>\n\n            <div ui-view="content"></div>\n        </div>\n        <!--/span-->\n    </div>\n    <!--/row-->\n</div>\n<!--/.fluid-container-->')}]),angular.module("/ng-modules/core/masterpages/page2C.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/core/masterpages/page2C.tpl.html",'<div class="container-fluid">\n    <div class="row-fluid">\n        <div class="span12">\n            <div ng-include="\'/ng-modules/core/breadcrumbs/breadcrumbs.tpl.html\'"></div>\n        </div>\n        <!--/span-->\n    </div>\n    <!--/row-->\n    <div class="row-fluid">\n        <div class="span3">\n            <div ui-view="sidebar"></div>\n        </div>\n        <div class="span9">\n            <div ui-view="content"></div>\n        </div>\n        <!--/span-->\n    </div>\n</div>\n<!--/.fluid-container-->')}]),angular.module("/ng-modules/core/masterpages/tabPage1C.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/core/masterpages/tabPage1C.tpl.html",'<div class="container-fluid">\n    <div class="row-fluid">\n        <div class="span12">\n            <div ng-include="\'/ng-modules/core/breadcrumbs/breadcrumbs.tpl.html\'"></div>\n        </div>\n    </div>\n    <!--/.row-fluid-->\n    <div class="row-fluid">\n        <div class="span12">\n            <div ui-view="tabbar"></div>\n        </div>\n    </div>\n    <!--/.row-fluid-->\n    <div class="row-fluid">\n        <div class="span12">\n            <div ui-view="content"></div>\n        </div>\n    </div>\n    <!--/.row-fluid-->\n</div>\n<!--/.fluid-container-->')}]),angular.module("/ng-modules/core/masterpages/tabPage2C.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/core/masterpages/tabPage2C.tpl.html",'<div class="container-fluid">\n    <div class="row-fluid">\n        <div class="span12">\n            <div ng-include="\'/ng-modules/core/breadcrumbs/breadcrumbs.tpl.html\'"></div>\n        </div>\n    </div>\n    <!--/.row-fluid-->\n    <div class="row-fluid">\n        <div class="span12">\n            <div ui-view="tabbar"></div>\n        </div>\n    </div>\n    <!--/.row-fluid-->\n    <div class="row-fluid">\n        <div class="span3">\n            <div ui-view="sidebar"></div>\n        </div>\n        <div class="span9">\n            <div ui-view="content"></div>\n        </div>\n    </div>\n    <!--/.row-fluid-->\n</div>\n<!--/.fluid-container-->')}]),angular.module("/ng-modules/core/security/login/form.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/core/security/login/form.tpl.html",'<form name="form" novalidate class="login-form">\n    <div class="modal-header">\n        <h4>Sign in</h4>\n    </div>\n    <div class="modal-body">\n        <div class="alert alert-warning" ng-show="authReason">\n            {{authReason}}\n        </div>\n        <div class="alert alert-error" ng-show="authError">\n            {{authError}}\n        </div>\n        <div class="alert alert-info">Please enter your login details</div>\n        <label>E-mail</label>\n        <input name="login" type="email" ng-model="user.email" required autofocus>\n        <label>Password</label>\n        <input name="pass" type="password" ng-model="user.password" required>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-primary login" ng-click="login()" ng-disabled=\'form.$invalid\'>Sign in</button>\n        <button class="btn clear" ng-click="clearForm()">Clear</button>\n        <button class="btn btn-warning cancel" ng-click="cancelLogin()">Cancel</button>\n    </div>\n</form>\n')}]),angular.module("/ng-modules/core/security/login/toolbar.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/core/security/login/toolbar.tpl.html",'<ul class="nav pull-right">\n  <li class="divider-vertical"></li>\n  <li ng-show="isAuthenticated()">\n      <a href="#">{{currentUser.firstName}} {{currentUser.lastName}}</a>\n  </li>\n  <li ng-show="isAuthenticated()" class="logout">\n      <form class="navbar-form">\n          <button class="btn logout" ng-click="logout()">Log out</button>\n      </form>\n  </li>\n  <li ng-hide="isAuthenticated()" class="login">\n      <form class="navbar-form">\n          <button class="btn login" ng-click="login()">Log in</button>\n      </form>\n  </li>\n</ul>')}]),angular.module("/ng-modules/core/systemmenu/systemMenu.tpl.html",[]).run(["$templateCache",function(a){a.put("/ng-modules/core/systemmenu/systemMenu.tpl.html",'\n        <div ng-controller="systemMenuCtrl">\n            *\n            <span ng-repeat="breadcrumb in current">\n                <a href="#!{{breadcrumb.url}}">{{breadcrumb.name}}</a> *\n            </span>\n        </div>\n')}]);